<!doctype html>
<html lang="it">
	<head>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-italia@2.8.4/dist/js/bootstrap-italia.bundle.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-italia@2.8.4/dist/css/bootstrap-italia.min.css" rel="stylesheet">

	<link rel="stylesheet"
		href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
		integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
		crossorigin="" />
	<!-- Make sure you put this AFTER Leaflet's CSS -->
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
		integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
		crossorigin=""></script>

	<script src="https://unpkg.com/leaflet-canvas-marker@0.2.0/dist/leaflet.canvas-markers.js"></script>

	<style type="text/css">
		#map { 
			height: 100vh;
		}
	</style>
	</head>
	<body>
	<main>
		<div class="container py-4">
			<header class="pb-3 mb-4 border-bottom">
				<span class="fs-4">Mappa Pubbliche Amministrazioni Italiane</span>
			</header>
			<div id="map"></div>
			<script type="text/javascript">
				var map = L.map('map').setView([42.00, 11.50], 5.5);
				L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
					maxZoom: 20,
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
				}).addTo(map);
				
				var ciLayer = L.canvasIconLayer({}).addTo(map);

				var icon = L.icon({
					iconUrl: 'marker-icon.png',
					iconSize: [12, 20],
					iconAnchor: [10, 9]
				});

				url = "v1/geo/geojson"
				// -- data
				fetch(url, {
					method: 'GET'
				})
				.then(response => response.json())
				.then(json => {
					json.features.forEach(function(item) {
						// Marker definition
						var description = ""
						for (company of item.properties.companies) {
							description += "<strong>" + company.denominazioneEnte + "</strong><br>Codice IPA: " + company.codiceIpa + "<br/>";
						}
						var marker =  
							L.marker(item.geometry.coordinates.reverse(), {icon: icon})
								.bindPopup(description);
						// Adding marker to layer
						ciLayer.addMarker(marker);
					});
				})
				.catch(error => {
					console.log('error on fetching company addresses!')
					console.error(error)
				});
			</script>
		</div>
	</main>
	</body>
</html>